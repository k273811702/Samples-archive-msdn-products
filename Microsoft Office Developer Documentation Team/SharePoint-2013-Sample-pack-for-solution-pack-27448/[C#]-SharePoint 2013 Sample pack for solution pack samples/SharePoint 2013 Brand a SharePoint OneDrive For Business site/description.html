<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/9bf1b74c-1640-46af-84d3-e440c8f95162Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>SharePoint 2013: Brand a SharePoint OneDrive For Business site</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>SharePoint 2013: Brand a SharePoint OneDrive For Business site</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            SharePoint Server 2013, apps for SharePoint
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            App model, User Experience, Microsoft SharePoint technologies, sites and content, My Site
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">5/21/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/SharePoint-2013-Brand-a-6da627cb">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="header">
<table id="bottomTable" cellspacing="0" cellpadding="0">
<tbody>
<tr id="headerTableRow1">
<td align="left"><span id="runningHeaderText">&nbsp;</span></td>
</tr>
<tr id="headerTableRow2">
<td align="left"><span id="nsrTitle">SharePoint 2013: Use remote provisioning to brand a SharePoint OneDrive for Business site</span></td>
</tr>
</tbody>
</table>
</div>
<div id="mainSection">
<div id="mainBody">
<div>
<p><span>Summary:</span> Learn how to use CSOM and the remote provisioning pattern to modify and brand OneDrive for Business sites.</p>
</div>
<div>
<p><strong>Last modified: </strong>April 11, 2014</p>
<p><strong>In this article</strong> <br>
<a href="#sectionSection0">Description of the sample</a> <br>
<a href="#sectionSection1">Scenario: Modify OneDrive for Business sites</a> <br>
<a href="#sectionSection2">Scenario: Theming a OneDrive for Business site</a> <br>
<a href="#sectionSection3">Prerequisites</a> <br>
<a href="#sectionSection4">Change log</a> <br>
<a href="#sectionSection5">Related content</a></p>
<p>This sample demonstrates how to use CSOM and the remote provisioning pattern to modify and brand a OneDrive for Business site.</p>
</div>
<h2>Description of the sample</h2>
<div id="sectionSection0">
<p>This sample demonstrates how to access an end-user's OneDrive for Business site and apply custom branding to it automatically. The sample accesses the OneDrive for Business site using the social .NET client-side model (CSOM), which provides read access to
 user profile properties as well as access to the Site object for the OneDrive for Business site.</p>
<p>Branding is applied by uploading a custom them to the Site object by using file upload mechanisms in the CSOM and then applying the theme to the site.</p>
<div>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th align="left"><strong>Note</strong> </th>
</tr>
<tr>
<td>
<p>Themes are not visible in the UI of OneDrive for Business sites, but you can still use them.</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>In general, Microsoft recommends branding OneDrive for Business sites using themes, and avoiding custom master page usage. If you customize master pages, you'll have to ensure that any new changes on the out-of-the-box master pages are reflected on custom
 master pages as well. On top of the themes, you can also inject custom CSS to the site to modify layout slightly without needing to change the master page.</p>
<p>Branding is applied from the app part. You can place the app part anywhere in the tenant since it operates across the site collections as needed. When the app part is accessing the OneDrive for Business site, the end-user will only see a GIF animation that
 indicates when app part is accessing the personal OneDrive for Business site. These locations are typical for this customizer:</p>
<ul>
<li>
<p>Intranet front page - When users arrive to Intranet, branding in SkyDrive Pro is checked and applied if needed</p>
</li><li>
<p>Public side of the my site - for example on the news feed page</p>
</li></ul>
<p>Code also stores the version of the branding used so that changes are only applied as needed. Applying changes on an as-needed basis minimizes performance issues that often arise when constantly deploying files.</p>
</div>
<h2>Scenario: Modify OneDrive for Business sites</h2>
<div id="sectionSection1">
<p>This scenario demonstrates how to access the user profile, create a personal OneDrive for Business site, and access and modify the site.</p>
<h3>Accessing the user profile</h3>
<div>
<p>Using the social CSOM API, you can access the user profile of particular user.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre>// Get user profile.
ProfileLoader loader = <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/Microsoft.SharePoint.Client.UserProfiles.ProfileLoader.GetProfileLoader.aspx"  title="Auto generated link to Microsoft.SharePoint.Client.UserProfiles.ProfileLoader.GetProfileLoader">Microsoft.SharePoint.Client.UserProfiles.ProfileLoader.GetProfileLoader</a>(clientContext);
UserProfile profile = loader.GetUserProfile();
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>User profile then gives access to additional options, like accessing stored information in the user profile properties or to get access to the personal OneDrive for Business site, as in this case.</p>
<p>&nbsp;</p>
</div>
<h3>Starting OneDrive for Business provisioning if it doesn't exist</h3>
<div>
<p>The following code uses a timer job-based approach to schedule the creation of a OneDrive for Business site if it has not yet been created for a particular user.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre><a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/Microsoft.SharePoint.Client.Site.aspx"  title="Auto generated link to Microsoft.SharePoint.Client.Site">Microsoft.SharePoint.Client.Site</a> personalSite = profile.PersonalSite;

clientContext.Load(personalSite);
clientContext.ExecuteQuery();

// Let's check if the site already exists.
if (personalSite.ServerObjectIsNull.Value)
{
    // Let's queue the personal site creation using an approach based on the out-of-the-box timer job.
    // Using async mode, since end user could go away from browser, you also could do this using an out-of-the-box web part.
    profile.CreatePersonalSiteEnque(true);
    clientContext.ExecuteQuery();
    WriteDebugInformationIfNeeded(&quot;My site was not present, will be provisioned.&quot;);
}
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>&nbsp;</p>
</div>
<h3>Accessing OneDrive for Business across site collections</h3>
<div>
<p>If a personal OneDrive for Business site has been already created, we can access that simply using standard CSOM after getting instance to the site collection object from the user profile.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre><a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/Microsoft.SharePoint.Client.Site.aspx"  title="Auto generated link to Microsoft.SharePoint.Client.Site">Microsoft.SharePoint.Client.Site</a> personalSite = profile.PersonalSite;

clientContext.Load(personalSite);
clientContext.ExecuteQuery();

Web rootWeb = personalSite.RootWeb;
clientContext.Load(rootWeb);
clientContext.ExecuteQuery();
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>&nbsp;</p>
</div>
</div>
<h2>Scenario: Theming a OneDrive for Business site</h2>
<div id="sectionSection2">
<p>This scenario demonstrates how to deploy a theme to a OneDrive for Business site and apply it.</p>
<h3>Deploy a theme</h3>
<div>
<p>The following code adds the new theme option to the theme item list, which would not be needed and is not visible on OneDrive for Business sites, but you can use the same pattern when deploying the theme to Team sites. This would create a new theme option
 that the user can select.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre>private void AddNewThemeOptionToSite(ClientContext clientContext, Web web)
{
    // Let's get instance of the themes list.
    List themesOverviewList = web.GetCatalog(124);
    clientContext.Load(themesOverviewList);
    clientContext.ExecuteQuery();
    // Is the item already in the list?
    if (!ContosoThemeEntryExists(clientContext, web, themesOverviewList))
    {
        // Let's create new theme entry. Notice that theme selection is not available from UI in OneDrive for Business sites, so this is only for consistency.
        ListItemCreationInformation itemInfo = new ListItemCreationInformation();
        <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/Microsoft.SharePoint.Client.ListItem.aspx"  title="Auto generated link to Microsoft.SharePoint.Client.ListItem">Microsoft.SharePoint.Client.ListItem</a> item = themesOverviewList.AddItem(itemInfo);
        item[&quot;Name&quot;] = &quot;Contoso&quot;;
        item[&quot;Title&quot;] = &quot;Contoso&quot;;
        item[&quot;ThemeUrl&quot;] = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/theme/15/contoso.spcolor&quot;); ;
        item[&quot;FontSchemeUrl&quot;] = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/theme/15/contoso.spfont&quot;); ;
        item[&quot;ImageUrl&quot;] = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/theme/15/contosobg.jpg&quot;);
        // Notice that we use oob master, but just as well you vould upload and use custom one
        item[&quot;MasterPageUrl&quot;] = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/masterpage/seattle.master&quot;);
        item[&quot;DisplayOrder&quot;] = 0;
        item.Update();
        clientContext.ExecuteQuery();
    }

}
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
</div>
<h3>Apply the theme</h3>
<div>
<p>The theme is applied with a single line of code as long as the URLs to the file are properly created.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre>//Set the properties for applying custom theme which was just uploaded.
string spColorURL = URLCombine(rootWeb.ServerRelativeUrl, &quot;/_catalogs/theme/15/contoso.spcolor&quot;);
string spFontURL = URLCombine(rootWeb.ServerRelativeUrl, &quot;/_catalogs/theme/15/contoso.spfont&quot;);
string backGroundImage = URLCombine(rootWeb.ServerRelativeUrl, &quot;/_catalogs/theme/15/contosobg.jpg&quot;);

// Use the Red theme for demonstration.
rootWeb.ApplyTheme(spColorURL,
                    spFontURL,
                    backGroundImage,
                    false);
clientContext.ExecuteQuery();</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>&nbsp;</p>
</div>
</div>
<h2>Prerequisites</h2>
<div id="sectionSection3">
<p>This sample requires the following:</p>
<ul>
<li>
<p>Visual Studio 2012 or Visual Studio 2013</p>
</li><li>
<p>A SharePoint 2013 development environment</p>
</li></ul>
</div>
<h2>Change log</h2>
<div id="sectionSection4"><strong>
<div class="caption"></div>
</strong>
<div>
<table cellspacing="2" cellpadding="5" width="50%" frame="lhs">
<tbody>
<tr>
<th>
<p>Version</p>
</th>
<th>
<p>Date</p>
</th>
</tr>
<tr>
<td>
<p>First version</p>
</td>
<td>
<p>February 26, 2014</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h2>Related content</h2>
<div id="sectionSection5">
<ul>
<li>
<p><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=2c8011b0-441a-4bab-bf19-6b1009c7d8dd" >SharePoint 2013 and SharePoint Online solution pack for branding and site provisioning</a></p>
</li></ul>
</div>
</div>
</div>

</div>


    </div>
</body>
</html>
