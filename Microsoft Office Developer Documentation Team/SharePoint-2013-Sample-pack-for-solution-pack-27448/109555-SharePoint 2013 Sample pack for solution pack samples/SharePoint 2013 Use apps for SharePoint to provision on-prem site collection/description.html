<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/1b88b18a-5268-4861-9da2-6c6e2539edaaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>SharePoint 2013: Use apps for SharePoint to provision on-prem site collection</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>SharePoint 2013: Use apps for SharePoint to provision on-prem site collection</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            SharePoint Server 2013, apps for SharePoint
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            web service, App model, Microsoft SharePoint technologies, Cloud Computing, sites and content
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">2/28/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/SharePoint-2013-Use-apps-9094e012">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="header">This sample demonstrates how to extend an on-premises SharePoint farm to support site collection creation from a provider-hosted app for SharePoint.</div>
<div id="mainSection">
<div id="mainBody">
<h1>Description of the sample</h1>
<div id="sectionSection0">
<p>This sample demonstrates how to extend an on-premises SharePoint farm to support site collection creation from provider-hosted app for SharePoint. This same pattern can be used to provide other extensions as well, such as exposing information management
 settings and other capabilities which are not natively available in the .NET Framework client-side object model (CSOM).</p>
<p>Remote site collection creation is supported natively in the Office365 (MT), but same capabilities are not available in CSOM for on-premises SharePoint. Specifically for site collection creation, you could also use the site admin web service (siteadmin.svc)
 in on-premises, but this capability has been depreciated and is not supported with in Office 365 (Dedicated).</p>
<h3>Site provisioning</h3>
<div>
<p>The provider-hosted app for SharePoint provisions the actual site collection by calling the custom Windows Communication Foundation (WCF) end point which has to be deployed to the farm as an extension point. This is a good example of so called &quot;smart&quot; on-premises
 extensions, where we only use the farm solution to expose additional APIs for remote access, rather than actually place the business logic to the farm.</p>
<p>In this way, you can control the business logic without updating the farm solutions in the SharePoint farm. This means that we can adjust the behavior without breaking or otherwise impacting the SharePoint services. Actual site collection creation API is
 exposed by the WCF end point as <strong><span class="keyword">CreateSiteCollection</span></strong> method. We can control the configuration of the site collection by providing different configuration options using complex data type called
<strong><span class="keyword">SiteData</span></strong>.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre>SiteManager.SiteManagerClient managerClient = GetSiteManagerClient();

SiteManager.SiteData newSite = new SiteManager.SiteData()
{
    Description = &quot;&quot;,
    LcId = &quot;1033&quot;,
    OwnerLogin = &quot;contoso\\administrator&quot;,
    SecondaryContactLogin = &quot;contoso\\alexclouti&quot;,
    Title = DateTime.Now.Ticks.ToString(),
    Url = &quot;sites/&quot; &#43; DateTime.Now.Ticks.ToString(),
    WebTemplate = &quot;STS#0&quot;
};

string url = managerClient.CreateSiteCollection(newSite);
status.Text = string.Format(&quot;Created site collection to {0}.&quot;, url);
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>&nbsp;</p>
<p>After the site collection has been created, CSOM APIs handle additional configuration options. In this case, we assign theme settings to the just created site collection by contacting its root web.</p>
<div><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th>C# </th>
<th>&nbsp;</th>
</tr>
<tr>
<td colspan="2">
<pre>using (var ctx = CreateAppOnlyClientContextForUrl(spContext, url))
{
    // Deploy the theme to the web so that we can set that for the site.
    Web web = ctx.Web;
    ctx.Load(web);
    ctx.ExecuteQuery();
    DeployThemeToWeb(ctx, web);

    //Set the properties for applying a custom theme that was just uploaded.
    string spColorURL = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/theme/15/contoso.spcolor&quot;);
    string spFontURL = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/theme/15/contoso.spfont&quot;);
    string backGroundImage = URLCombine(web.ServerRelativeUrl, &quot;/_catalogs/theme/15/contosobg.jpg&quot;);

    // Use the Red theme for demonstration.
    web.ApplyTheme(spColorURL,
                        spFontURL,
                        backGroundImage,
                        false);
    ctx.ExecuteQuery();

    // Redirect to just created site
    Response.Redirect(url);
}</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>&nbsp;</p>
</div>
</div>
<h1>Prerequisites</h1>
<div id="sectionSection1">
<p>This sample requires the following:</p>
<ul>
<li>
<p>Visual Studio 2012 or Visual Studio 2013</p>
</li><li>
<p>Microsoft Office Developer tools for Visual Studio</p>
</li><li>
<p>A SharePoint 2013 development environment</p>
</li></ul>
</div>
<h1>Change log</h1>
<div id="sectionSection2"><strong>
<div class="caption"></div>
</strong>
<div>
<table cellspacing="2" cellpadding="5" width="50%" frame="lhs">
<tbody>
<tr>
<th>
<p>Version</p>
</th>
<th>
<p>Date</p>
</th>
</tr>
<tr>
<td>
<p>First version</p>
</td>
<td>
<p>February 26, 2014</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<h1>Related content</h1>
<div id="sectionSection3">
<ul>
<li>
<p><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=2c8011b0-441a-4bab-bf19-6b1009c7d8dd" >SharePoint 2013 and SharePoint Online solution pack for branding and site provisioning</a></p>
</li></ul>
</div>
</div>
</div>

</div>


    </div>
</body>
</html>
