<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/9bf1b74c-1640-46af-84d3-e440c8f95162Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Provision sites in batches with the app model</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Provision sites in batches with the app model</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            SharePoint Server 2013, apps for SharePoint
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            apps for SharePoint
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/24/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Provision-sites-in-batches-fcf31bc6">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="header">
<table id="bottomTable" cellpadding="0" cellspacing="0">
<tbody>
<tr id="headerTableRow1">
<td align="left"><span id="runningHeaderText"></span></td>
</tr>
<tr id="headerTableRow2">
<td align="left"><span id="nsrTitle">SharePoint 2013: Provision sites in batches with the app model</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="mainSection">
<div id="mainBody">
<div>
<p><span>Summary:</span> Learn how to create SharePoint 2013 site collections in batches with an app for SharePoint that runs as a console application.</p>
</div>
<div>
<p></p>
</div>
<h1>Description of the sample</h1>
<div id="sectionSection0" name="collapseableSection">
<p>This sample provider-hosted app for SharePoint shows how to create SharePoint 2013 site collections by using the client object model. This app for SharePoint runs as a console application that you can host remotely, and it uses the app only permission policy.
 The app requires full control at the tenant scope.</p>
</div>
<h1>Prerequisites</h1>
<div id="sectionSection1" name="collapseableSection">
<p>This sample requires the following:</p>
<ul>
<li>
<p>An Office 365 SharePoint site</p>
<div>
<table width="100%" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<th align="left"><b>Note</b> </th>
</tr>
<tr>
<td>
<p>The code that creates a site collection will not work on an Office 365 Developer Site.</p>
</td>
</tr>
</tbody>
</table>
</div>
</li><li>
<p>Visual Studio 2012 and Office Developer Tools for Visual Studio 2012 installed on your development computer</p>
</li><li>
<p>A <a href="http://code.msdn.microsoft.com/Provision-sites-in-batches-fcf31bc6/https://manage.windowsazure.com" >Windows Azure account</a> with permissions to deploy a cloud service</p>
</li><li>
<p>Windows Azure SDK for .NET (VS 2012) 1.8</p>
</li></ul>
</div>
<h1>Key components of the sample</h1>
<div id="sectionSection2" name="collapseableSection">
<p>The sample app contains the following:</p>
<ul>
<li>
<p><b>Batch Provisioning project</b>, which contains the AppManifest.xml file. This file registers the provider-hosted app with SharePoint.</p>
</li><li>
<p><b>Batch Provisioning Console project</b>, which contains:</p>
<ul>
<li>
<p><b>App.config file:</b> Contains the client id and secret for the app</p>
</li><li>
<p><b>Sites.xml:</b> Contains a list of the names of the site collections that the app will create</p>
</li><li>
<p><b>Program.cs:</b> Contains the code that provisions the site collections listed in Sites.xml</p>
</li><li>
<p><b>TokenHelper.cs:</b> Contains the helper code that enables the app to get the required permissions for creating site collections. This file is not a default component of the console application template in Visual Studio 2013. You can get this file by creating
 a provider-hosted or autohosted app for SharePoint and copying the file from the remote web application to the console app project.</p>
</li></ul>
</li><li>
<p><b>Batch ProvisioningWeb project</b>, which contains the TokenHelper.cs file and also the default components of a provider-hosted app. You can deploy this web application to a Windows Azure site to make sure that your app's credentials are working.</p>
</li></ul>
</div>
<h1>Configure the sample</h1>
<div id="sectionSection3" name="collapseableSection">
<p>Follow these steps to configure the sample.</p>
<ol>
<li>
<p>Open the <b>Batch Provisioning.sln</b> file in Visual Studio 2012.</p>
</li><li>
<p>In the <b><span class="ui">Properties</span></b> pane, change the <b><span class="ui">Site URL</span></b> property. It is the absolute URL of your SharePoint test site collection on Office 365: https://<span>&lt;my tenant&gt;</span>.sharepoint.com/.</p>
</li></ol>
</div>
<h1>Build, deploy, and run the sample</h1>
<div id="sectionSection4" name="collapseableSection">
<h3>To build and deploy the Batch Provisioning web application</h3>
<div>
<ol>
<li>
<p>Create an empty website on Windows Azure and download the publishing profile for that site.</p>
</li><li>
<p>Register an app at the /_layouts/15/appregnew.aspx page of your SharePoint test site collection on Office 365: https://<span>&lt;my tenant&gt;</span>.sharepoint.com/_layouts/15/appregnew.aspx. Be sure to fill in the following details:</p>
<ul>
<li>
<p>Generate a client ID and client secret. You'll need to add both values to the <b>
web.config</b> and <b>app.config</b> files in the solution. You'll also need to provide the client secret to the publishing wizard.</p>
</li><li>
<p>Enter the URL of the website that you created on Windows Azure for <b><span class="ui">App Domain</span></b>.</p>
</li><li>
<p>Leave the <b><span class="ui">Redirect URI</span></b> field empty.</p>
</li></ul>
</li><li>
<p>Open the <b>App.config</b> file in the <b>Batch Provisioning Console</b> project and add values for the
<b><span class="keyword">ClientId</span></b> and <b><span class="keyword">ClientSecret</span></b> keys. Use the client id and client secret values that you created when you registered the app.</p>
</li><li>
<p>Open the <b>Web.config</b> file in the <b>Batch ProvisioningWeb</b> project and add values for the
<b>ClientId</b> and <b>ClientSecret</b> keys. These values are the same as the ones that you add to the
<b>App.config</b> file.</p>
</li><li>
<p>Open the <b>Program.cs</b> file in the <b>Batch Provisioning Console</b> project. Add values for these variables:</p>
<ul>
<li>
<p><b><span class="keyword">sharePointUrl</span> </b>: This must be the URL of the admin site of your Office 365 tenant. You can find this URL by going to the home page of your Office 365 SharePoint site, clicking the
<b><span class="ui">Admin</span></b> menu, and selecting <b><span class="ui">SharePoint</span></b>.</p>
</li><li>
<p><b><span class="keyword">path</span> </b>: The file system path that points to the location of your
<b>Sites.xml</b> file.</p>
</li><li>
<p><b><span class="keyword">Owner</span> </b>parameter of <b><span class="keyword">newSite</span></b>: The email address of the administrator of your Office 365 tenant. This user must be a tenant administrator.</p>
</li></ul>
</li><li>
<p>Open the <b>Sites.xml</b> file in the <b>Batch Provisioning Console</b> project. Add at least one or more URLs for the site or sites that you want to create in your Office 365 tenant.</p>
</li><li>
<p>Right-click the <b><span class="ui">Batch ProvisioningWeb</span></b> project in
<b><span class="ui">Solution Explorer</span></b>, and then select <b><span class="ui">Publishing</span></b>.</p>
</li><li>
<p>Follow the instructions to import the publishing profile of your Windows Azure site, and publish the project to Windows Azure.</p>
</li></ol>
</div>
<h3>To build and deploy the app for SharePoint</h3>
<div>
<ol>
<li>
<p>Right-click the <b><span class="ui">Batch Provisioning</span></b> project in
<b><span class="ui">Solution Explorer</span></b>, and then select <b><span class="ui">Publish</span></b>.</p>
</li><li>
<p>For <b><span class="ui">Which profile do you want to publish</span></b>, type
<span>Batch Provisioning</span> to create a publishing profile. Click <b><span class="ui">Next</span></b>.</p>
</li><li>
<p>For <b><span class="ui">Where is your website hosted</span></b>, type the location of the Windows Azure site where you published the
<b><span class="ui">Batch ProvisioningWeb</span></b> project.</p>
</li><li>
<p>For client ID, type the client ID value that you created when you registered the app.</p>
</li><li>
<p>For client secret, type the client secret value that you created when you registered the app.</p>
</li><li>
<p>Click <b><span class="ui">Next</span></b>, and then click <b><span class="ui">Finish</span></b>.
</p>
<p>The resulting app package file has an .app extension (Batch Provisioning.app) and is saved in the
<b><span class="ui">app.publish</span></b> subfolder of the <b><span class="ui">bin\Debug</span></b> folder of the Visual Studio solution.</p>
</li><li>
<p>In your browser, navigate to your Office 365 site. Click the <b><span class="ui">Admin</span></b> drop-down list in the upper right corner of the page and select
<b><span class="ui">SharePoint</span></b> to go to the SharePoint admin center.</p>
</li><li>
<p>Click <b><span class="ui">apps</span></b> in the left panel, and then click <b>
<span class="ui">App Catalog</span></b> in the center column.</p>
<p>If you don't have an App Catalog site, you'll have to follow the instructions to create a new one.</p>
</li><li>
<p>Upload the Batch Provisioning.app file that you created when you published the
<b>Batch Provisioning</b> project to the App Catalog by following these steps:</p>
<ol>
<li>
<p>Click <b><span class="ui">Apps for SharePoint</span></b> in the left panel.</p>
</li><li>
<p>Click <b><span class="ui">Files</span></b>, <b><span class="ui">Upload Document</span></b> in the ribbon and browse to the Batch Provisioning.app file. You don't have to add any metadata or change any of the default values.
</p>
</li><li>
<p>Click <b><span class="ui">OK</span></b>.</p>
</li></ol>
</li><li>
<p>In your browser, navigate to the site collection in your Office 365 where you want to deploy the app.</p>
</li><li>
<p>Click the gear icon in the top right of the page, and select <b><span class="ui">Add an app</span></b> from the drop-down menu.</p>
</li><li>
<p>You'll see a new app named <b><span class="ui">Batch Provisioning</span></b>. Click the name, and then click
<b><span class="ui">Trust It</span></b>.</p>
<p>Wait for the app to install.</p>
</li></ol>
</div>
<h3>To run the sample</h3>
<div>
<ol>
<li>
<p>After the app installs completely, click the app icon to launch the app.</p>
</li><li>
<p>Verify that the site name appears on your Windows Azure site. This verifies that your app's credentials are working.</p>
</li><li>
<p>Right-click the <b><span class="ui">Batch Provisioning Console</span></b> project in
<b><span class="ui">Solution Explorer</span></b>. Select <b><span class="ui">Start new instance</span></b> from the
<b><span class="ui">Debug</span></b> menu. While the console app is running, go to your Office 365 site, click on the
<b><span class="ui">Admin</span></b> menu, and select <b><span class="ui">SharePoint</span></b>. The
<b><span class="ui">Site Collections</span></b> list will display your new site or sites and note that they are being provisioned.</p>
</li></ol>
</div>
</div>
<h1>Troubleshooting</h1>
<div id="sectionSection5" name="collapseableSection">
<p>This app will throw an exception if you try to create a new site collection on an Office 365 Developer Site.</p>
<p></p>
</div>
<h1>Change log</h1>
<div id="sectionSection6" name="collapseableSection">
<p>First release.</p>
</div>
<h1>Related content</h1>
<div id="sectionSection7" name="collapseableSection">
<ul>
<li>
<p><a href="http://blogs.msdn.com/b/vesku/archive/2013/08/23/site-provisioning-techniques-and-remote-provisioning-in-sharepoint-2013.aspx" >Site provisioning techniques and remote provisioning in SharePoint 2013</a>
</p>
</li><li>
<p><a href="http://blogs.msdn.com/b/richard_dizeregas_blog/archive/2013/04/04/self-service-site-provisioning-using-apps-for-sharepoint-2013.aspx" >Self-Service Site Provisioning using Apps for SharePoint 2013</a>
</p>
</li><li>
<p><a href="http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx" >Office365 - Apply automatically custom branding to personal site (SkyDrive Pro)</a>
</p>
</li></ul>
</div>
</div>
</div>

</div>


    </div>
</body>
</html>
