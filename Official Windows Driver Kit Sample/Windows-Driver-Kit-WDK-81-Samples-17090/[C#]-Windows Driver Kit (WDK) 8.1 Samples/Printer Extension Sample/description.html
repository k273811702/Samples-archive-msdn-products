<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:sprite;/Areas/Epx/Themes/Windows/Content:0&amp;amp;hashKey=B5E5F4F4AE5278BDA2ADB3607072DA9C" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/dc96e5d0-205a-4f07-963c-0adecf31d9c1Combined.css,0:sprite,1:LinkList;/Areas/Epx/Themes/Windows/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=3985696AFC623BD5CCF8BE823D027701" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Printer Extension Sample</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" /><link href="description/19eccd10-9a4c-4ebc-a240-2680a581332eBrand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Printer Extension Sample</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            printer, Windows Driver
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Printing
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/2/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/windowshardware/Printer-extension-sample-0e3e1562">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="mainSection">
<p>This sample demonstrates how to use .NET to build a customized, desktop UI for a v4 print driver. This .NET app uses PrintTicket, PrintCapabilities and Bidi in order to communicate with the print system and is suitable for inclusion in a v4 print driver.
</p>
<p class="note"><b>Note</b>&nbsp;&nbsp;This sample is for the v4 print driver model.</p>
<p></p>
<p class="note"><b>Note</b>&nbsp;&nbsp;</p>
<p class="note">To build this sample, you can use Microsoft Visual Studio&nbsp;2013 (Express, Professional, or Ultimate) and Windows Driver Kit (WDK)&nbsp;8.1 Update. This sample will not build with Microsoft Visual Studio Express&nbsp;2013 for Windows Desktop, because
 the sample uses Active Template Library (ATL). You can get Visual Studio&nbsp;2013 and WDK&nbsp;8.1 Update
<a href="http://go.microsoft.com/fwlink/p/?LInkID=239721">here</a>.</p>
<p class="note">You can also build this sample with Visual Studio&nbsp;2013 (Professional or Ultimate) and
<a href="http://go.microsoft.com/fwlink/p/?LInkID=391348">Windows Driver Kit (WDK)&nbsp;8.1</a>.</p>
<p class="note">For Windows Driver Kit (WDK)&nbsp;8 samples, download the <a href="http://code.msdn.microsoft.com/windowshardware/Printer-extension-sample-0e3e1562/ http://go.microsoft.com/fwlink/?LinkId=317090">
WDK&nbsp;8 samples pack</a>. The samples in the WDK&nbsp;8 samples pack will build only with Microsoft Visual Studio Professional&nbsp;2012 (Professional or Ultimate) and WDK&nbsp;8.</p>
<p></p>
<p></p>
<h2><a id="related_topics"></a>Related topics</h2>
<dl><dt><a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff554644">Building a Driver</a>
</dt><dt><a href="http://msdn.microsoft.com/en-us/library/hh464103(v=vs.85).aspx">v4 Print Driver Interfaces and Enumerations</a>
</dt></dl>
<h2>Operating system requirements</h2>
<table>
<tbody>
<tr>
<th>Client</th>
<td><dt>Windows&nbsp;8 </dt></td>
</tr>
<tr>
<th>Server</th>
<td><dt>Windows Server&nbsp;2012 </dt></td>
</tr>
</tbody>
</table>
<h2>Build the sample</h2>
<p>To build, run and test this sample, you must have a v4 print driver and a print queue already installed. The sample should be saved to c:\apps.</p>
<p>Perform the following steps to build the sample.</p>
<p><b>Add your PrinterDriverID to the PrinterExtensionSample</b> </p>
<dl><dd>1. Find your PrinterDriverID
<dl><dd>a. Open PowerShell </dd><dd>b. Type the following script to find your printer where “printer name” is the name of your print queue.
<div class="code"><span>
<table>
<tbody>
<tr>
<th>cmd</th>
</tr>
<tr>
<td>
<pre>$printDriverID = Get-Content ((Get-Printer &quot;Printer name” | Get-PrinterDriver).DependentFiles | Where-Object -FilterScript:{$_ -like &quot;*manifest.ini&quot;}) | Where-Object -FilterScript:{$_ -like &quot;PrinterDriverId*&quot;}
($printDriverID.Split(&quot;=&quot;))[1];</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
</dd><dd>c. Copy the GUID value that was output, including both curly braces {}. </dd></dl>
</dd><dd>2. Add the PrinterDriverID to the printer extension
<dl><dd>a. Open Microsoft Visual Studio. </dd><dd>b. In <b>Solution Explorer</b>, expand PrinterExtensionSample, then right click on App.xaml. Choose View Code.
</dd><dd>c. Scroll to the bottom of the file, and edit the variable PrinterDriverID. Select everything inside the double-quotes and paste.
</dd></dl>
</dd><dd>3. Build the project
<dl><dd>a. In <b>Solution Explorer</b>, right click on the PrinterExtensionSample solution and choose
<b>Build Solution</b>. </dd></dl>
</dd></dl>
<p><b>Register your printer extension</b> </p>
<dl><dd>
<p>1. Open Notepad</p>
</dd><dd>
<p>2. Type the following:</p>
<div class="code"><span>
<table>
<tbody>
<tr>
<th>cmd</th>
</tr>
<tr>
<td>
<pre>Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\OfflinePrinterExtensions]

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\OfflinePrinterExtensions\{PrinterExtensionId}]
&quot;AppPath&quot;=&quot;c:\\apps\\Printer extension sample\\C#\\ExtensionSample\\bin\\Debug\\PrinterExtensionSample.exe&quot;

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\OfflinePrinterExtensions\{PrinterExtensionId}\{PrinterDriverId}]

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\OfflinePrinterExtensions\{PrinterExtensionId}\{PrinterDriverId}\{EC8F261F-267C-469F-B5D6-3933023C29CC}]
@=&quot;1&quot;
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
</dd><dd>
<p>3. Click <b>Edit</b> &gt; <b>Replace</b>.</p>
</dd><dd>
<p>4. In the <b>Find</b> textbox type {PrinterDriverId}, and in the <b>Replace</b> textbox type the PrinterDriverID value that you found using Powershell.</p>
</dd><dd>
<p>5. Open Visual Studio, click <b>Tools</b> &gt; <b>Create Guid</b>. Select <b>Registry Format</b> &gt;
<b>Copy</b>.</p>
</dd><dd>
<p>6. Go back to Notepad and click <b>Edit</b> &gt; <b>Replace</b>. Find {PrinterExtensionId} and replace it with the GUID you just created.</p>
</dd><dd>
<p>7. Click <b>File</b> &gt; <b>Save</b>, and Save this file in C:\Apps\PrinterExtensionSample. Name the file register.reg. Change the file type to All files.</p>
</dd><dd>
<p>8. Open a Windows Explorer window and navigate to C:\apps\PrinterExtensionSample.</p>
</dd><dd>
<p>9. Double-click the register.reg file and click yes on any prompts.</p>
</dd></dl>
<p>For information on how to build a driver solution using Visual Studio, see <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff554644">
Building a Driver</a>.</p>
<h2>Run the sample</h2>
<p></p>
<dl><dd>
<p>1. Open an app that supports printing, for example Notepad. Then click <b>File</b> &gt;
<b>Print</b>.</p>
</dd><dd>
<p>2. In the print window, select your print queue, and then click <b>Preferences</b>. This should launch your PrinterExtensionSample app.</p>
</dd></dl>
<p></p>
<p>If your app is not launched, the registration request may have failed, or the request may not have been processed in time. Try launching the app again, and if it continues to fail, confirm that the PrintNotify service is running.</p>
<p><b>Debugging the sample</b> </p>
<p>In order to debug your sample at startup, it is useful to create a MessageBox in the beginning of the OnDriverEvent method of App.xaml.cs. Once your app is running and the MessageBox is visible, you can attach to it using Visual Studio.</p>
<dl><dd>1. Debug your sample using Visual Studio.
<dl><dd>a. In Visual Studio, click <b>Debug</b> &gt; <b>Attach to Process</b>. </dd><dd>b. Find PrinterExtensionSample.exe in the list, then select <b>Attach</b>. </dd><dd>c. Set any relevant breakpoints, then click <b>OK</b> in the MessageBox to continue.
</dd></dl>
</dd></dl>
<p></p>
</div>

</div>


    </div>
</body>
</html>
